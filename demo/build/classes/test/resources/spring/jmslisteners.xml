<?xml version="1.0" encoding="UTF-8"?>
<!-- beans for services refactor -->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd"
			 default-lazy-init="false" default-autowire="no" default-dependency-check="none">


	<bean id="notificationListener" class="com.workmarket.service.infra.jms.NotificationListenerImpl" />
	<bean id="jmsContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="emailDestination" />
		<property name="messageListener" ref="notificationListener" />
	</bean>

	<bean id="jsmListenerThreadPoolTaskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
		<property name="corePoolSize" value="30" />
		<property name="maxPoolSize" value="250" />
		<property name="daemon" value="true" />
		<property name="keepAliveSeconds" value="30" />
	</bean>

	<bean id="workNotificationListener" class="com.workmarket.service.infra.jms.NotificationListenerImpl" />
	<bean id="workNotificationJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="workEmailDestination" />
		<property name="messageListener" ref="workNotificationListener" />
	</bean>

	<bean id="eventListener" class="com.workmarket.service.infra.jms.EventListener" />
	<bean id="eventJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="eventDestination" />
		<property name="messageListener" ref="eventListener" />
	</bean>

	<!-- Listens for regular reindex events -->
	<bean id="reindexEventListener" class="com.workmarket.service.infra.jms.EventListener" />
	<bean id="reindexEventJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="reindexEventDestination" />
		<property name="messageListener" ref="reindexEventListener" />
	</bean>

	<bean id="jobListener" class="com.workmarket.service.infra.jms.JobListener" />
	<bean id="jobJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="jobDestination" />
		<property name="messageListener" ref="jobListener" />
		<property name="concurrentConsumers" value="2" />
		<property name="maxConcurrentConsumers" value="5" />
		<property name="errorHandler">
			<bean name="batchJmsErrorHandler" class="com.workmarket.service.infra.jms.JmsErrorHandler">
				<constructor-arg value="job" />
			</bean>
		</property>
		<property name="taskExecutor" ref="jsmListenerThreadPoolTaskExecutor" />
	</bean>

	<bean id="batchListener" class="com.workmarket.service.infra.jms.BatchListener" />
	<bean id="batchJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="batchDestination" />
		<property name="messageListener" ref="batchListener" />
	</bean>

	<bean id="metricEventListener" class="com.workmarket.service.infra.jms.EventListener" />
	<bean id="metricEventJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory" />
		<property name="destination" ref="metricEventDestination" />
		<property name="messageListener" ref="metricEventListener" />
		<property name="concurrentConsumers" value="2" />
		<property name="maxConcurrentConsumers" value="5" />
		<property name="errorHandler">
			<bean name="batchJmsErrorHandler" class="com.workmarket.service.infra.jms.JmsErrorHandler">
				<constructor-arg value="job" />
			</bean>
		</property>
		<property name="taskExecutor" ref="jsmListenerThreadPoolTaskExecutor" />
	</bean>


	<bean id="uploadsListener" class="com.workmarket.api.v2.employer.uploads.async.UploadListener"/>
	<bean id="uploadsJMSContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="connectionFactory" ref="amqConnectionFactory"/>
		<property name="destination" ref="uploadsDestination"/>
		<property name="messageListener" ref="uploadsListener"/>
		<property name="concurrentConsumers" value="5"/>
		<property name="maxConcurrentConsumers" value="25"/>
		<property name="errorHandler">
			<bean name="batchJmsErrorHandler" class="com.workmarket.service.infra.jms.JmsErrorHandler">
				<constructor-arg value="bulk"/>
			</bean>
		</property>
		<property name="taskExecutor" ref="jsmListenerThreadPoolTaskExecutor"/>
	</bean>

</beans>